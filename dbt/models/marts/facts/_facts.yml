version: 2

models:
  - name: fct_sales
    description: >
      Order-level sales fact table. Grain: one row per completed order.
      Contains revenue measures and links to customer, employee, location, 
      payment method, and order type dimensions.
    columns:
      - name: order_id
        description: Primary key (degenerate dimension)
        tests:
          - unique
          - not_null
      - name: date_key
        description: Foreign key to dim_date
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_key
      - name: customer_sk
        description: Foreign key to dim_customer
        tests:
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_sk
              config:
                severity: warn
      - name: employee_sk
        description: Foreign key to dim_employee
        tests:
          - relationships:
              arguments:
                to: ref('dim_employee')
                field: employee_sk
              config:
                severity: warn
      - name: location_sk
        description: Foreign key to dim_location
        tests:
          - relationships:
              arguments:
                to: ref('dim_location')
                field: location_sk
              config:
                severity: warn
      - name: total_amount
        description: Total order amount (must be non-negative)
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
      - name: discount_amount
        description: Discount applied to order
    tests:
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          arguments:
            column_A: subtotal
            column_B: discount_amount
            or_equal: true
          config:
            severity: warn

  - name: fct_sales_line_item
    description: >
      Line-item level sales fact table. Grain: one row per order item.
      Contains quantity, revenue, and profit measures with links to 
      menu item dimension for product analysis.
    columns:
      - name: order_item_id
        description: Primary key
        tests:
          - unique
          - not_null
      - name: order_id
        description: Foreign key to fct_sales
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('fct_sales')
                field: order_id
      - name: date_key
        description: Foreign key to dim_date
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_key
      - name: menu_item_sk
        description: Foreign key to dim_menu_item
        tests:
          - relationships:
              arguments:
                to: ref('dim_menu_item')
                field: menu_item_sk
              config:
                severity: warn
      - name: customer_sk
        description: Foreign key to dim_customer
        tests:
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_sk
              config:
                severity: warn
      - name: location_sk
        description: Foreign key to dim_location
        tests:
          - relationships:
              arguments:
                to: ref('dim_location')
                field: location_sk
              config:
                severity: warn
      - name: quantity
        description: Number of items ordered
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 1
      - name: line_total
        description: Total for this line item
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0

  - name: fct_inventory_snapshot
    description: >
      Periodic inventory snapshot fact table. Grain: one row per 
      location/ingredient/day. Contains stock quantities and status indicators.
    columns:
      - name: inventory_snapshot_id
        description: Primary key
        tests:
          - unique
          - not_null
      - name: quantity_on_hand
        description: Quantity in inventory
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0

  - name: fct_daily_summary
    description: >
      Aggregated daily summary fact table. Grain: one row per location/day.
      Pre-aggregated metrics for efficient dashboard queries.
    columns:
      - name: daily_summary_id
        description: Surrogate key
        tests:
          - unique
          - not_null
      - name: date_key
        description: Foreign key to dim_date
        tests:
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_key
      - name: location_sk
        description: Foreign key to dim_location
        tests:
          - relationships:
              arguments:
                to: ref('dim_location')
                field: location_sk
              config:
                severity: warn
      - name: total_orders
        description: Total orders for the day
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
      - name: total_revenue
        description: Total revenue for the day
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0

  - name: fct_customer_activity
    description: >
      Customer activity accumulating snapshot fact table. Grain: one row per customer.
      Contains lifetime metrics, RFM scores, and favorite analysis.
    columns:
      - name: customer_sk
        description: Primary key (reference to dim_customer)
        tests:
          - unique
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_sk

  - name: fct_menu_item_performance
    description: >
      Menu item performance metrics fact table. Grain: one row per menu item.
      Contains aggregate sales, profit, and ranking metrics.
    columns:
      - name: menu_item_sk
        description: Primary key (reference to dim_menu_item)
        tests:
          - unique
          - not_null
          - relationships:
              arguments:
                to: ref('dim_menu_item')
                field: menu_item_sk
