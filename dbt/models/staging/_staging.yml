version: 2

models:
  - name: stg_locations
    description: Staged location data with type casting and cleaning
    columns:
      - name: location_id
        description: Primary key for location
        tests:
          - unique
          - not_null

  - name: stg_customers
    description: Staged customer data with type casting and cleaning
    columns:
      - name: customer_id
        description: Primary key for customer
        tests:
          - unique
          - not_null

  - name: stg_employees
    description: Staged employee data with type casting and cleaning
    columns:
      - name: employee_id
        description: Primary key for employee
        tests:
          - unique
          - not_null
      - name: location_id
        description: Foreign key to location
        tests:
          - relationships:
              arguments:
                to: ref('stg_locations')
                field: location_id
      - name: hourly_rate
        description: Employee hourly pay rate
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 7.25
                max_value: 100
              config:
                severity: warn

  - name: stg_menu_items
    description: Staged menu item data with type casting and cleaning
    columns:
      - name: item_id
        description: Primary key for menu item
        tests:
          - unique
          - not_null
      - name: base_price
        description: Base price of menu item
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
                strictly_greater_than_min: true

  - name: stg_ingredients
    description: Staged ingredient data with type casting and cleaning
    columns:
      - name: ingredient_id
        description: Primary key for ingredient
        tests:
          - unique
          - not_null
      - name: supplier_id
        description: Foreign key to supplier
        tests:
          - relationships:
              arguments:
                to: ref('stg_suppliers')
                field: supplier_id
              config:
                severity: warn

  - name: stg_menu_item_ingredients
    description: Staged recipe/BOM data linking menu items to ingredients
    columns:
      - name: item_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_menu_items')
                field: item_id
      - name: ingredient_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_ingredients')
                field: ingredient_id

  - name: stg_orders
    description: Staged order header data with type casting and cleaning
    columns:
      - name: order_id
        description: Primary key for order
        tests:
          - unique
          - not_null
      - name: customer_id
        description: Foreign key to customer (nullable for guest orders)
        tests:
          - relationships:
              arguments:
                to: ref('stg_customers')
                field: customer_id
              config:
                severity: warn
                where: "customer_id is not null"
      - name: employee_id
        description: Foreign key to employee
        tests:
          - relationships:
              arguments:
                to: ref('stg_employees')
                field: employee_id
              config:
                severity: warn
      - name: location_id
        description: Foreign key to location
        tests:
          - relationships:
              arguments:
                to: ref('stg_locations')
                field: location_id
              config:
                severity: warn
      - name: total_amount
        description: Total order amount
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
      - name: discount_amount
        description: Discount applied to order
    tests:
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          arguments:
            column_A: subtotal
            column_B: discount_amount
            or_equal: true
          config:
            severity: warn

  - name: stg_order_items
    description: Staged order line item data with type casting and cleaning
    columns:
      - name: order_item_id
        description: Primary key for order line item
        tests:
          - unique
          - not_null
      - name: order_id
        description: Foreign key to order
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_orders')
                field: order_id
      - name: item_id
        description: Foreign key to menu item
        tests:
          - relationships:
              arguments:
                to: ref('stg_menu_items')
                field: item_id
              config:
                severity: warn

  - name: stg_suppliers
    description: Staged supplier data with type casting and cleaning
    columns:
      - name: supplier_id
        description: Primary key for supplier
        tests:
          - unique
          - not_null

  - name: stg_inventory
    description: Staged inventory snapshot data with type casting and cleaning
    columns:
      - name: inventory_id
        description: Primary key for inventory record
        tests:
          - unique
          - not_null
      - name: location_id
        description: Foreign key to location
        tests:
          - relationships:
              arguments:
                to: ref('stg_locations')
                field: location_id
      - name: ingredient_id
        description: Foreign key to ingredient
        tests:
          - relationships:
              arguments:
                to: ref('stg_ingredients')
                field: ingredient_id
      - name: quantity_on_hand
        description: Current inventory quantity
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
